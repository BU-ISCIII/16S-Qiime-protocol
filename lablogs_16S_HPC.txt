# ANALYSIS
# Please don't run this very script at 23:59, just in case
# Generates the directory where the analysis will be held
# Generates the sample name list
# Generates the directory with renamed links for each read
# Generates the manifest file to import the sequences to qiime2
mkdir -p $(date '+%Y%m%d')_ANALYSIS01_16S
ls ../RAW/*.gz | cut -d "/" -f3 | cut -d "_" -f1 | sort -u > samples_id.txt
mkdir -p 00-reads
cd 00-reads; cat ../samples_id.txt | xargs -I % echo "ln -s ../../RAW/%_*R1*.fastq.gz %_R1.fastq.gz" | bash;
cat ../samples_id.txt | xargs -I % echo "ln -s ../../RAW/%_*R2*.fastq.gz %_R2.fastq.gz" | bash; cd -
printf "sample-id\tforward-absolute-filepath\treverse-absolute-filepath\n" > manifest.tsv
cat samples_id.txt | xargs -I % printf "%\t$(pwd)/$(date '+%Y%m%d')_ANALYSIS01_16S/03-fastp_preprocess/%/%_R1_filtered.fq.gz\t$(pwd)/$(date '+%Y%m%d')_ANALYSIS01_16S/03-fastp_preprocess/%/%_R2_filtered.fq.gz\n" >> manifest.tsv 

# ANALYSIS01_16S
# Generates the directory structure for the analysis
# Generates a symbolic link to the sample-list, named samples directory and manifest
mkdir 01-fastQC_previous	
mkdir 02-cutadapt_remove_primers	
mkdir 03-fastp_preprocess	
mkdir 04-fastQC_posterior	
mkdir 05-qiime2_import	
mkdir 06-qiime2_denoise_cluster	
mkdir 07-qiime2_taxonomy	
mkdir 08-qiime2_filt_mit_chl	
mkdir 09-qiime2_taxabarplots
mkdir 09-qiime2_taxabarplots/01-Full
mkdir 09-qiime2_taxabarplots/02-Filtered
mkdir 10-qiime2_absoluteNumbers
mkdir 10-qiime2_absoluteNumbers/01-Full
mkdir 10-qiime2_absoluteNumbers/02-Filtered
mkdir 11-qiime2_pylogeny
mkdir 11-qiime2_pylogeny/01-Full
mkdir 11-qiime2_pylogeny/02-Filtered
mkdir 12-qiime2_diversity
mkdir 12-qiime2_diversity/01-Full
mkdir 12-qiime2_diversity/02-Filtered
mkdir 13-qiime2_rarefaction
mkdir 13-qiime2_rarefaction/01-Full
mkdir 13-qiime2_rarefaction/02-Filtered
mkdir 99-stats
ln -s ../00-reads .
ln -s ../samples_id.txt .
ln -s ../manifest.tsv .

# 01-fastQC_previous
# fastQC to assess the raw reads quality
# conda activate quality_control
cat ../samples_id.txt | xargs -I % echo "mkdir %; qsub -V -b y -j y -cwd -N PRE_FQC_% -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 fastqc -o % ../00-reads/%*.fastq.gz" > _01_fastqc_pre_trimming.sh

# 02-cutadapt_remove_primers
# cutadapt to remove the sequencing primers
# conda activate quality_control
cat ../samples_id.txt | xargs -I % echo "mkdir %; qsub -V -b y -j y -cwd -N CUTADPT_% -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 cutadapt -a {ADAPTER_R1} -A {ADAPTER_R2} --json %/%.cutadapt.json -o %/%_adapter_removed_R1.fastq.gz -p %/%_adapter_removed_R2.fastq.gz ../00-reads/%_R1.fastq.gz ../00-reads/%_R2.fastq.gz" > _01_cutadapt.sh

# 03-preprocessing_fastp
# fastp to trim the raw sequences and improve quality
# conda activate quality_control
cat ../samples_id.txt | xargs -I % echo "mkdir %; qsub -V -b y -j y -cwd -N FASTP_% -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 fastp -i ../02-cutadapt_remove_primers/%/%_adapter_removed_R1.fastq.gz -I ../02-cutadapt_remove_primers/%/%_adapter_removed_R2.fastq.gz --trim_poly_x --cut_front --cut_tail --cut_mean_quality 20 --length_required 250 --qualified_quality_phred 30 --cut_window_size 4 --html %/%_trim_report_fastp.html --json %/%_trim_report_fastp.json -o %/%_R1_filtered.fq.gz -O %/%_R2_filtered.fq.gz" > _01_fastp.sh

# 04-fastQC_posterior
# fastQC to asses the trimmed reads quality	
# conda activate quality_control
cat ../samples_id.txt | xargs -I % echo "mkdir %;  qsub -V -b y -j y -cwd -N POST_FQC_% -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 fastqc -o % ../03-preprocessing_fastp/%/%_*_filtered.fq.gz" > _01_fastqc_post_trimming.sh

# 05-qiime2_import
# Import the sequences in the manifest into a qiime2 object
# Generate the visual files for the created objects: importseqs
# conda activate qiime2021.2
echo "qsub -V -b y -j y -cwd -N Q2_IMPORT -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime tools import --type \"SampleData[PairedEndSequencesWithQuality]\" --input-path ../manifest.tsv --output-path paired-end-demux.qza --input-format PairedEndFastqManifestPhred33V2" > _01_qiime2_import.sh
echo "qsub -V -b y -j y -cwd -N Q2_IMPORT_VISUAL -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime demux summarize --i-data paired-end-demux.qza --o-visualization paired-end-demux.qzv" > _02_qiime2_import_visualfile.sh

# 06-qiime2_denoise_cluster
# Use the dada2 module in qiime2 to denoise, ligate and cluster the reads
# Generate the visual files for the created objects: repseqs, stats, feature table, tabulated repseqs, summarized feature table
# conda activate qiime2021.2
echo "qsub -V -b y -j y -cwd -N Q2_DADA2 -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime dada2 denoise-paired --i-demultiplexed-seqs ../05-qiime2_import/paired-end-demux.qza --p-trunc-len-f 0 --p-trunc-len-r 0 --p-n-threads 0 --o-representative-sequences rep_seqs_full.qza --o-table feature_table_full.qza --o-denoising-stats stats_dada2.qza" > _01_qiime2_dada2.sh
echo "qsub -V -b y -j y -cwd -N Q2_REPSEQS_VISUAL -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime metadata tabulate --m-input-file rep_seqs_full.qza --o-visualization rep_seqs_full.qzv" > _02_qiime2_dada2_visualfiles.sh
echo "qsub -V -b y -j y -cwd -N Q2_STATS_VISUAL -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime metadata tabulate --m-input-file stats_dada2.qza --o-visualization stats_dada2.qzv" >> _02_qiime2_dada2_visualfiles.sh
echo "qsub -V -b y -j y -cwd -N Q2_FTABLE_VISUAL -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime metadata tabulate --m-input-file feature_table_full.qza --o-visualization feature_table_full.qzv" >> _02_qiime2_dada2_visualfiles.sh
echo "qsub -V -b y -j y -cwd -N Q2_FTABLE_SUMM_VISUAL -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime feature-table summarize --i-table feature_table_full.qza --o-visualization feature_table_full_summarized.qzv --m-sample-metadata-file ../metadata.tsv" >> _02_qiime2_dada2_visualfiles.sh
echo "qsub -V -b y -j y -cwd -N Q2_TAB_REPSEQS_VISUAL -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime feature-table tabulate-seqs --i-data rep_seqs_full.qza --o-visualization feature_table_tabulated_seqs.qzv" >> _02_qiime2_dada2_visualfiles.sh

# 07-qiime2_taxonomy
# Use the previously-trained Naive Bayes classifier to identify the rep seqs
# Generate the visual files for the created objects: taxonomy
# conda activate qiime2021.2
echo "qsub -V -b y -j y -cwd -N Q2_IDENTIFICATE -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime feature-classifier classify-sklearn --i-classifier /data/bi/references/QIIME2/2021.2_bayes_silva.qza --i-reads ../06-qiime2_denoise_cluster/rep_seqs_full.qza --o-classification taxonomy.qza" > _01_qiime2_taxonomic_identification.sh
echo "qsub -V -b y -j y -cwd -N Q2_TAX_VISUAL -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime metadata tabulate --m-input-file taxonomy.qza --o-visualization taxonomy.qzv" > _02_qiime2_taxonomic_visual.sh

# 08-qiime2_filt_mit_chl
# Filter mitochondria and chloroplast from the feature table and rep-seqs
# Generate the visual files for the created objects: filtered feature table, summarized filtered feature table, filtered rep seqs 
# conda activate qiime2021.2
echo "qsub -V -b y -j y -cwd -N Q2_FILTER -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime taxa filter-table --i-table ../06-qiime2_denoise_cluster/feature_table_full.qza --i-taxonomy ../07-qiime2_taxonomy/taxonomy.qza --p-exclude mitochondria,chloroplast --o-filtered-table feature_table_filtered.qza" > _01_qiime2_filter_table_repseqs.sh
echo "qsub -V -b y -j y -cwd -N Q2_REPSEQS_FILT_VISUAL -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime taxa filter-seqs --i-sequences ../06-qiime2_denoise_cluster/rep_seqs_full.qza --i-taxonomy ../07-qiime2_taxonomy/taxonomy.qza --p-exclude mitochondria,chloroplast --o-filtered-sequences rep_seqs_filtered.qza" >> _01_qiime2_filter_table_repseqs.sh
echo "qsub -V -b y -j y -cwd -N Q2_FTABLE_FILT_VISUAL -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime metadata tabulate --m-input-file feature_table_filtered.qza --o-visualization feature_table_filtered.qzv" > _02_qiime2_filtered_visualfiles.sh
echo "qsub -V -b y -j y -cwd -N Q2_FTABLE_FILT_SUMM_VISUAL -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime feature-table summarize --i-table feature_table_filtered.qza --o-visualization feature_table_filtered_summarized.qzv --m-sample-metadata-file ../metadata.tsv" >> _02_qiime2_filtered_visualfiles.sh
echo "qsub -V -b y -j y -cwd -N Q2_REPSEQS_FILT_VISUAL -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime feature-table tabulate-seqs --i-data rep_seqs_filtered.qza --o-visualization rep_seqs_filtered.qzv" >> _02_qiime2_filtered_visualfiles.sh

# 09-qiime2_taxabarplots/01-Full
# Generates the visual file with the barplot for the full (unfiltered) feature tables
# conda activate qiime2021.2
echo "qsub -V -b y -j y -cwd -N Q2_BARPLOT_FULL -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime taxa barplot --i-table ../../06-qiime2_denoise_cluster/feature_table_full.qza --i-taxonomy ../../07-qiime2_taxonomy/taxonomy.qza --m-metadata-file ../../metadata.tsv --o-visualization taxa_barplots_full.qzv" > _01_qiime2_taxa_barplots_full.sh

# 09-qiime2_taxabarplots/02-Filtered
# Generates the visual file with the barplot for the filtered feature tables
# conda activate qiime2021.2
echo "qsub -V -b y -j y -cwd -N Q2_BARPLOT_FILT -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime taxa barplot --i-table ../../08-qiime2_filt_mit_chl/feature_table_filtered.qza --i-taxonomy ../../07-qiime2_taxonomy/taxonomy.qza --m-metadata-file ../../metadata.tsv --o-visualization taxa_barplots_filtered.qzv" > _01_qiime2_filter_taxa_barplots.sh

# 10-qiime2_absoluteNumbers/01-Full
# Generates a table (row=samples; column=taxa) with absolute hit numbers collapsed to lvl 7, species from the full (unfiltered) table
# conda activate qiime2021.2
ln -s /data/bi/pipelines/16S-Qiime-protocol/process_table.py  process_table.py
echo "qsub -V -b y -j y -cwd -N Q2_COLLAPSE_FULL_TABLE -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime taxa collapse --i-table ../../06-qiime2_denoise_cluster/feature_table_full.qza --i-taxonomy ../../07-qiime2_taxonomy/taxonomy.qza --p-level 7 --o-collapsed-table collapsed_full_table_lvl_7.qza" > _01_qiime2_collapse_table.sh
echo "qsub -V -b y -j y -cwd -N Q2_EXPORT_FULL_BIOM -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime tools export --input-path collapsed_full_table_lvl_7.qza --output-path ." > _02_qiime2_export_biom_table.sh
echo "qsub -V -b y -j y -cwd -N Q2_CONVERT_FULL_TABLE -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 biom convert --input-fp feature-table.biom --output-fp transposed_full_table.tsv --to-tsv" > _03_qiime2_biom_to_tsv.sh
echo "qsub -V -b y -j y -cwd -N PY_TRANSPOSE_FULL_TABLE -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 python process_table.py transposed_full_table.tsv absolute_numbers_taxonomy_full.tsv" > _04_python_transpose_tsv.sh

# 10-qiime2_absoluteNumbers/02-Filtered
# Generates a table (row=samples; column=taxa) with absolute hit numbers collapsed to lvl 7, species from the filtered table
# conda activate qiime2021.2
ln -s /data/bi/pipelines/16S-Qiime-protocol/process_table.py  process_table.py
echo "qsub -V -b y -j y -cwd -N Q2_COLLAPSE_FILT_TABLE -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime taxa collapse --i-table ../../08-qiime2_filt_mit_chl/feature_table_filtered.qza --i-taxonomy ../../07-qiime2_taxonomy/taxonomy.qza --p-level 7 --o-collapsed-table collapsed_filtered_table_lvl_7.qza" > _01_qiime2_collapse_filtered_table.sh
echo "qsub -V -b y -j y -cwd -N Q2_EXPORT_FILT_BIOM -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime tools export --input-path collapsed_filtered_table_lvl_7.qza --output-path ." > _02_qiime2_export_biom_filtered_table.sh
echo "qsub -V -b y -j y -cwd -N Q2_CONVERT_FILT_TABLE -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 biom convert --input-fp feature-table.biom --output-fp transposed_filtered_table.tsv --to-tsv" > _03_qiime2_biom_to_tsv.sh
echo "qsub -V -b y -j y -cwd -N PY_TRANSPOSE_FILT_TABLE -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 python process_table.py transposed_filtered_table.tsv absolute_numbers_taxonomy_filtered.tsv" >  _04_python_transpose_tsv.sh

# 11-qiime2_pylogeny/01-Full
# Calculates the phylogenetic tree for the full (unfiltered) rep-seqs 
# conda activate qiime2021.2
echo "qsub -V -b y -j y -cwd -N Q2_PHYLO_FULL -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime phylogeny align-to-tree-mafft-fasttree --i-sequences ../06-qiime2_denoise_cluster/rep_seqs_full.qza --o-alignment aligned_rep_seqs_full.qza --o-masked-alignment masked_aligned_rep_seqs_full.qza --o-tree unrooted_tree_full.qza --o-rooted-tree rooted_tree_full.qza" > _01_qiime2_align.sh

# 11-qiime2_pylogeny/02-Filtered
# Calculates the phylogenetic tree for the filtered rep-seqs 
# conda activate qiime2021.2
echo "qsub -V -b y -j y -cwd -N Q2_PHYLO_FILT -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime phylogeny align-to-tree-mafft-fasttree --i-sequences ../08-qiime2_filt_mit_chl/rep_seqs_filtered.qza --o-alignment aligned_filtered_rep_seqs.qza --o-masked-alignment masked_aligned_filtered_rep_seqs.qza --o-tree unrooted_tree_filtered.qza --o-rooted-tree rooted_tree_filtered.qza" > _01_qiime2_align_filtered.sh

# 12-qiime2_diversity/01-Full
# Calculates the diversity parameters for the full (unfiltered) table using the phylogeny
# conda activate qiime2021.2
# Must be provided with a number for the sampling depth. Value is extracted from the full summarized table
echo "qsub -V -b y -j y -cwd -N Q2_PHYLOGENY_FULL -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime diversity core-metrics-phylogenetic --i-phylogeny ../11-qiime2_pylogeny/01-Full/rooted_tree_full.qza --i-table ../06-qiime2_denoise_cluster/feature_table_full.qza --p-sampling-depth $1 --m-metadata-file ../../metadata.tsv --output-dir ." > _01_qiime2_alpha_diversity_full.sh
echo "qsub -V -b y -j y -cwd -N Q2_FAITH_FULL_VISUAL -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime diversity alpha-group-significance --i-alpha-diversity faith_pd_vector.qza --m-metadata-file ../../metadata.tsv --o-visualization faith_pd_summarized_full.qzv" >  _02_qiime2_faith_shannon.sh
echo "qsub -V -b y -j y -cwd -N Q2_SHANNON_FULL_VISUAL -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime diversity alpha-group-significance --i-alpha-diversity shannon_vector.qza --m-metadata-file ../../metadata.tsv --o-visualization shannon_vector_summarized_full.qzv" >> _02_qiime2_faith_shannon.sh

# 12-qiime2_diversity/02-Filtered
# Calculates the diversity parameters for the filtered table using the phylogeny
# Must be provided with a number for the sampling depth. Value is extracted from the filtered summarized table
# conda activate qiime2021.2
echo "qsub -V -b y -j y -cwd -N Q2_PHYLOGENY_FILT -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime diversity core-metrics-phylogenetic --i-phylogeny ../11-qiime2_pylogeny/02-Filtered/rooted_tree_filtered.qza --i-table ../../08-qiime2_filt_mit_chl/feature_table_filtered.qza --p-sampling-depth $1 --m-metadata-file ../../metadata.tsv --output-dir ." > _01_qiime2_alpha_diversity_filtered.sh
echo "qsub -V -b y -j y -cwd -N Q2_FAITH_FILT_VISUAL -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime diversity alpha-group-significance --i-alpha-diversity faith_pd_vector.qza --m-metadata-file ../../metadata.tsv --o-visualization faith_pd_summarized_filtered.qzv" > _02_qiime2_faith_shannon_filtered.sh
echo "qsub -V -b y -j y -cwd -N Q2_SHANNON_FILT_VISUAL -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime diversity alpha-group-significance --i-alpha-diversity shannon_vector.qza --m-metadata-file ../../metadata.tsv --o-visualization shannon_vector_summarized_filtered.qzv" >> _02_qiime2_faith_shannon_filtered.sh

# 13-qiime2_rarefaction/01-Full
# Calculates the rarefaction curve for the full (unfiltered) table
# Must be provided with a number for max-depth, extracted from the full summarized table
# conda activate qiime2021.2
echo "qsub -V -b y -j y -cwd -N RAREFACTION_FULL -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime diversity alpha-rarefaction --i-table ../../06-qiime2_denoise_cluster/feature_table_full.qza --i-phylogeny ../../11-qiime2_pylogeny/01-Full/rooted_tree_full.qza --p-max-depth $1 --m-metadata-file ../../metadata.tsv --o-visualization alpha_rarefaction_full.qzv" > _01_qiime2_alpha_rarefaction.sh

# 13-qiime2_rarefaction/02-Filtered
# Calculates the rarefaction curve for the full (unfiltered) table
# Must be provided with a number for max-depth, extracted from the filtered summarized table
# conda activate qiime2021.2
echo "qsub -V -b y -j y -cwd -N RAREFACTION_FILT -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 qiime diversity alpha-rarefaction --i-table ../../08-qiime2_filt_mit_chl/feature_table_filtered.qza --i-phylogeny ../../11-qiime2_pylogeny/02-Filtered/rooted_tree_filtered.qza --p-max-depth $1 --m-metadata-file ../../metadata.tsv --o-visualization alpha_rarefaction_filtered.qzv" > _01_qiime_alpha_rarefaction_filtered.sh

# 99-stats
# multiQC to assess the general quality of the reads
echo "qsub -V -b y -j y -cwd -N MULTIQC -q all.q@obelix09,all.q@obelix10,all.q@obelix11,all.q@obelix12,all.q@obelix13,all.q@obelix14,all.q@obelix15 multiqc ../01-fastQC_previous/*/* ../02-cutadapt_remove_primers/*/* ../03-fastp_preprocess/*/* ../04-fastQC_posterior/*/* -o ." > _05_multiqc.sh 